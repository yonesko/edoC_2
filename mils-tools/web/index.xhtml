<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core">
<h:body>
    <ui:composition template="template/masterLayout.xhtml">
        <ui:define name="windowTitle">
            #{labels.indexTitle}
        </ui:define>
        <ui:define name="content">
            <script type="text/javascript">
                var iframe = document.getElementById('cooot'),src = iframe.src;
                iframe.src = '';
                document.onload =  function(){iframe.src = src;}
            </script>
            <script type="text/javascript">
                var host = "ws://localhost:8081/ChatEndpoint";
                var wSocket = new WebSocket(host);
                var browserSupport = ("WebSocket" in window) ? true : false;

                // called  body onLoad()
                function initializeReception()
                {
                    if (browserSupport)
                    {
                        wSocket.onopen = function()
                        {
                            console.log(" Web Socket is connected, sending data");
                            wSocket.send("ping");
                        };
                    }
                    else
                    {
                        // The browser doesn't support WebSocket
                        alert("WebSocket is NOT supported by your Browser!");
                    }
                }

                // called when a message is received
                wSocket.onmessage = function(event)
                {
                    var received_msg = event.data;
//                    console.log(received_msg);
                    mojarra.ab(this,event,'action','@form','chat');
                };

                // called when socket closes
                wSocket.onclose = function()
                {
                    // websocket is closed.
                    //alert("Connection is closed...");
                };
            </script>
            <h:form prependId="false">
                <h:panelGrid>
                    <h:inputTextarea id="SQLtext" rows="20" cols="90" value="#{evalParamsBean.SQLtext}" required="true"/>
                    <h:message for="SQLtext" showSummary="false" errorClass="errors"/>
                    <h:panelGroup>
                        <h:commandButton value="#{labels.eval}" action="result"/>
                        <h:commandButton type="reset" value="#{labels.clear}" onclick="clearFields()"/>
                    </h:panelGroup>
                </h:panelGrid>
            </h:form>
            <div align="right">
                <iframe src="http://tv.giphy.com/cat" class="img-rounded" id="cooot"></iframe>
            </div>
            <h:form prependId="false" onkeypress="if (event.keyCode == 13) { document.getElementById('send').click(); return false; }">
                <div style="overflow: auto; width: 400px; height: 300px; text-align: left" >
                    <h:dataTable id="chat" value="#{chatBean.chatHistory}" var="msg">
                        <h:column>
                            #{msg.author}:
                        </h:column>
                        <h:column>
                            #{msg.content}
                        </h:column>
                    </h:dataTable>
                </div>
                <h:panelGrid>
                    <h:panelGroup>
                        Ð¯:
                        <h:inputText label="#{labels.author}" id="chatMsgAuthor" value="#{chatBean.author}" required="true">
                            <f:validateLength minimum="1" maximum="10"/>
                        </h:inputText>
                    </h:panelGroup>
                    <h:message for="chatMsgAuthor"/>
                    <h:inputTextarea label="#{labels.content}" id="chatMsgContent" rows="3" cols="30" value="#{chatBean.msg}" required="true">
                        <f:validateLength minimum="1" maximum="100"/>
                    </h:inputTextarea>
                    <h:message for="chatMsgContent"/>
                    <h:commandButton id="send" value="send" action="#{chatBean.submit}">
                        <f:ajax render="chat" execute="@form"/>
                    </h:commandButton>
                </h:panelGrid>
            </h:form>
        </ui:define>
    </ui:composition>
</h:body>
</html>
